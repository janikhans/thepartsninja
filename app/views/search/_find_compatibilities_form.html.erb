<%= simple_form_for :compatibilities, url: compat_results_search_path, method: :get, remote: true do |f| %>
  <%= f.input :category_name, input_html: {class: "js-category-autocomplete"}, wrapper_html: {class:"search-field"}, label: false, placeholder: "What part are you looking for?" %>
  <%= f.input :vehicle_brand, collection: @brands, class:"form-control", label: false, prompt: "Make...", input_html: {class: "chosen-select" } %>
  <%= f.input :vehicle_model, collection: [], class: "form-control", label: false, prompt: "Model...", input_html: {class: "chosen-select" }%>
  <%= f.input :vehicle_submodel, collection: [], class:"form-control", label: false, prompt: "Submodel..." %>
  <%= f.input :vehicle_year, collection: [], prompt: "Year...", label: false, class:"form-control" %>
  <%= hidden_field_tag "compatibilities[vehicle][id]", nil, id: "compatibilities_vehicle" %>
  <%#= f.input :vehicle, as: :hidden %>
  <%= f.submit "Find", id: "compatibilities-process", class: "btn btn-default" %>
  </div>
<% end %>

<script type="text/javascript">

  $(function() {
    var initialize_categories_typeahead;
    initialize_categories_typeahead = function() {
      var categories_typeahead = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.obj.whitespace("name"),
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        prefetch: "/categories/1/leaves"
      });
      categories_typeahead.initialize();
      return $(".js-category-autocomplete").typeahead(null, {
        displayKey: "name",
        source: categories_typeahead.ttAdapter()
      });
    };
    return initialize_categories_typeahead();
  });

  dynamic_vehicle_form("compatibilities_vehicle");

  $("#compatibilities_vehicle_year").on("change", function() {
    var vehicleId = $(this).val();
    $("#compatibilities_vehicle").val(vehicleId);
  });
</script>
